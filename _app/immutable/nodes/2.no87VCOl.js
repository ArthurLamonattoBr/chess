import"../chunks/NZTpNUN0.js";import{i as Li}from"../chunks/B84ke6ih.js";import{a as Ii,l as Bi,o as qi,e as os,s as ze}from"../chunks/Ke8UanKF.js";import{a1 as Mi,b as Di,s as gt,h as J,S as Fi,a as Ki,w as P,ak as xt,r as Ui,c as Vi,d as as,e as mt,i as Me,T as Hi,X as Qi,f as Ts,g as Os,p as Wi,ay as vt,$ as Ns,L as cs,az as hs,au as ce,aA as ls,Q as Yi,aB as Ft,aC as Gi,_ as ji,aD as zi,aE as Xi,aF as Kt,aG as Ji,V as Zi,aH as Rs,O as er,aI as tr,aJ as sr,aK as ir,aL as rr,aM as nr,aN as or,aO as ar,t as cr,af as hr,A as lr,B as ht,C as Xe,m as De,D as fr,F as ae,I as Ae,am as N,G as ie,j as ur,k as pr}from"../chunks/Bst8NX7R.js";import{i as fs}from"../chunks/D-y6tqGj.js";function us(i,e){return e}function dr(i,e,t,s){for(var r=[],n=e.length,o=0;o<n;o++)Gi(e[o].e,r,!0);var a=n>0&&r.length===0&&t!==null;if(a){var u=t.parentNode;ji(u),u.append(t),s.clear(),ge(i,e[0].prev,e[n-1].next)}zi(r,()=>{for(var d=0;d<n;d++){var _=e[d];a||(s.delete(_.k),ge(i,_.prev,_.next)),Xi(_.e,!a)}})}function ps(i,e,t,s,r,n=null){var o=i,a={flags:e,items:new Map,first:null},u=(e&Rs)!==0;if(u){var d=i;o=J?gt(Fi(d)):d.appendChild(Mi())}J&&Ki();var _=null,v=!1,p=xt(()=>{var m=t();return Yi(m)?m:m==null?[]:Ns(m)});Di(()=>{var m=P(p),y=m.length;if(v&&y===0)return;v=y===0;let T=!1;if(J){var L=Ui(o)===Vi;L!==(y===0)&&(o=as(),gt(o),mt(!1),T=!0)}if(J){for(var V=null,Q,D=0;D<y;D++){if(Me.nodeType===Hi&&Me.data===Qi){o=Me,T=!0,mt(!1);break}var S=m[D],R=s(S,D);Q=xs(Me,a,V,null,S,R,D,r,e,t),a.items.set(R,Q),V=Q}y>0&&gt(as())}J||_r(m,a,o,r,e,s,t),n!==null&&(y===0?_?Ts(_):_=Os(()=>n(o)):_!==null&&Wi(_,()=>{_=null})),T&&mt(!0),P(p)}),J&&(o=Me)}function _r(i,e,t,s,r,n,o){var a=(r&tr)!==0,u=(r&(Kt|Ft))!==0,d=i.length,_=e.items,v=e.first,p=v,m,y=null,T,L=[],V=[],Q,D,S,R;if(a)for(R=0;R<d;R+=1)Q=i[R],D=n(Q,R),S=_.get(D),S!==void 0&&(S.a?.measure(),(T??=new Set).add(S));for(R=0;R<d;R+=1){if(Q=i[R],D=n(Q,R),S=_.get(D),S===void 0){var pe=p?p.e.nodes_start:t;y=xs(pe,e,y,y===null?e.first:y.next,Q,D,R,s,r,o),_.set(D,y),L=[],V=[],p=y.next;continue}if(u&&gr(S,Q,R,r),(S.e.f&vt)!==0&&(Ts(S.e),a&&(S.a?.unfix(),(T??=new Set).delete(S))),S!==p){if(m!==void 0&&m.has(S)){if(L.length<V.length){var fe=V[0],Y;y=fe.prev;var ye=L[0],ee=L[L.length-1];for(Y=0;Y<L.length;Y+=1)ds(L[Y],fe,t);for(Y=0;Y<V.length;Y+=1)m.delete(V[Y]);ge(e,ye.prev,ee.next),ge(e,y,ye),ge(e,ee,fe),p=fe,y=ee,R-=1,L=[],V=[]}else m.delete(S),ds(S,p,t),ge(e,S.prev,S.next),ge(e,S,y===null?e.first:y.next),ge(e,y,S),y=S;continue}for(L=[],V=[];p!==null&&p.k!==D;)(p.e.f&vt)===0&&(m??=new Set).add(p),V.push(p),p=p.next;if(p===null)continue;S=p}L.push(S),y=S,p=S.next}if(p!==null||m!==void 0){for(var z=m===void 0?[]:Ns(m);p!==null;)(p.e.f&vt)===0&&z.push(p),p=p.next;var ne=z.length;if(ne>0){var xe=(r&Rs)!==0&&d===0?t:null;if(a){for(R=0;R<ne;R+=1)z[R].a?.measure();for(R=0;R<ne;R+=1)z[R].a?.fix()}dr(e,z,xe,_)}}a&&er(()=>{if(T!==void 0)for(S of T)S.a?.apply()}),cs.first=e.first&&e.first.e,cs.last=y&&y.e}function gr(i,e,t,s){(s&Kt)!==0&&hs(i.v,e),(s&Ft)!==0?hs(i.i,t):i.i=t}function xs(i,e,t,s,r,n,o,a,u,d){var _=(u&Kt)!==0,v=(u&Ji)===0,p=_?v?ce(r,!1,!1):ls(r):r,m=(u&Ft)===0?o:ls(o),y={i:m,v:p,k:n,a:null,e:null,prev:t,next:s};try{return y.e=Os(()=>a(i,p,m,d),J),y.e.prev=t&&t.e,y.e.next=s&&s.e,t===null?e.first=y:(t.next=y,t.e.next=y.e),s!==null&&(s.prev=y,s.e.prev=y.e),y}finally{}}function ds(i,e,t){for(var s=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==s;){var o=Zi(n);r.before(n),n=o}}function ge(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const _s=[...` 	
\r\fÂ \v\uFEFF`];function mr(i,e,t){var s=i==null?"":""+i;if(e&&(s=s?s+" "+e:e),t){for(var r in t)if(t[r])s=s?s+" "+r:r;else if(s.length)for(var n=r.length,o=0;(o=s.indexOf(r,o))>=0;){var a=o+n;(o===0||_s.includes(s[o-1]))&&(a===s.length||_s.includes(s[a]))?s=(o===0?"":s.substring(0,o))+s.substring(a+1):o=a}}return s===""?null:s}function gs(i,e,t,s,r,n){var o=i.__className;if(J||o!==t||o===void 0){var a=mr(t,s,n);(!J||a!==i.getAttribute("class"))&&(a==null?i.removeAttribute("class"):i.className=a),i.__className=t}else if(n&&r!==n)for(var u in n){var d=!!n[u];(r==null||d!==!!r[u])&&i.classList.toggle(u,d)}return n}const vr=Symbol("is custom element"),yr=Symbol("is html");function br(i){if(J){var e=!1,t=()=>{if(!e){if(e=!0,i.hasAttribute("value")){var s=i.value;ct(i,"value",null),i.value=s}if(i.hasAttribute("checked")){var r=i.checked;ct(i,"checked",null),i.checked=r}}};i.__on_r=t,sr(t),Ii()}}function ct(i,e,t,s){var r=Er(i);J&&(r[e]=i.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&i.nodeName==="LINK")||r[e]!==(r[e]=t)&&(e==="loading"&&(i[ir]=t),t==null?i.removeAttribute(e):typeof t!="string"&&wr(i).includes(e)?i[e]=t:i.setAttribute(e,t))}function Er(i){return i.__attributes??={[vr]:i.nodeName.includes("-"),[yr]:i.namespaceURI===rr}}var ms=new Map;function wr(i){var e=ms.get(i.nodeName);if(e)return e;ms.set(i.nodeName,e=[]);for(var t,s=i,r=Element.prototype;r!==s;){t=or(s);for(var n in t)t[n].set&&e.push(n);s=nr(s)}return e}function kr(i,e,t=e){var s=ar();Bi(i,"input",r=>{var n=r?i.defaultValue:i.value;if(n=yt(i)?bt(n):n,t(n),s&&n!==(n=e())){var o=i.selectionStart,a=i.selectionEnd;i.value=n??"",a!==null&&(i.selectionStart=o,i.selectionEnd=Math.min(a,i.value.length))}}),(J&&i.defaultValue!==i.value||cr(e)==null&&i.value)&&t(yt(i)?bt(i.value):i.value),hr(()=>{var r=e();yt(i)&&r===bt(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}function yt(i){var e=i.type;return e==="number"||e==="range"}function bt(i){return i===""?null:+i}const le=Object.create(null);le.open="0";le.close="1";le.ping="2";le.pong="3";le.message="4";le.upgrade="5";le.noop="6";const st=Object.create(null);Object.keys(le).forEach(i=>{st[le[i]]=i});const Pt={type:"error",data:"parser error"},Ps=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",$s=typeof ArrayBuffer=="function",Ls=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,Ut=({type:i,data:e},t,s)=>Ps&&e instanceof Blob?t?s(e):vs(e,s):$s&&(e instanceof ArrayBuffer||Ls(e))?t?s(e):vs(new Blob([e]),s):s(le[i]+(e||"")),vs=(i,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(i)};function ys(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let Et;function Ar(i,e){if(Ps&&i.data instanceof Blob)return i.data.arrayBuffer().then(ys).then(e);if($s&&(i.data instanceof ArrayBuffer||Ls(i.data)))return e(ys(i.data));Ut(i,!1,t=>{Et||(Et=new TextEncoder),e(Et.encode(t))})}const bs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ue=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<bs.length;i++)Ue[bs.charCodeAt(i)]=i;const Cr=i=>{let e=i.length*.75,t=i.length,s,r=0,n,o,a,u;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const d=new ArrayBuffer(e),_=new Uint8Array(d);for(s=0;s<t;s+=4)n=Ue[i.charCodeAt(s)],o=Ue[i.charCodeAt(s+1)],a=Ue[i.charCodeAt(s+2)],u=Ue[i.charCodeAt(s+3)],_[r++]=n<<2|o>>4,_[r++]=(o&15)<<4|a>>2,_[r++]=(a&3)<<6|u&63;return d},Sr=typeof ArrayBuffer=="function",Vt=(i,e)=>{if(typeof i!="string")return{type:"message",data:Is(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:Tr(i.substring(1),e)}:st[t]?i.length>1?{type:st[t],data:i.substring(1)}:{type:st[t]}:Pt},Tr=(i,e)=>{if(Sr){const t=Cr(i);return Is(t,e)}else return{base64:!0,data:i}},Is=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},Bs="",Or=(i,e)=>{const t=i.length,s=new Array(t);let r=0;i.forEach((n,o)=>{Ut(n,!1,a=>{s[o]=a,++r===t&&e(s.join(Bs))})})},Nr=(i,e)=>{const t=i.split(Bs),s=[];for(let r=0;r<t.length;r++){const n=Vt(t[r],e);if(s.push(n),n.type==="error")break}return s};function Rr(){return new TransformStream({transform(i,e){Ar(i,t=>{const s=t.length;let r;if(s<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,s);else if(s<65536){r=new Uint8Array(3);const n=new DataView(r.buffer);n.setUint8(0,126),n.setUint16(1,s)}else{r=new Uint8Array(9);const n=new DataView(r.buffer);n.setUint8(0,127),n.setBigUint64(1,BigInt(s))}i.data&&typeof i.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(t)})}})}let wt;function Je(i){return i.reduce((e,t)=>e+t.length,0)}function Ze(i,e){if(i[0].length===e)return i.shift();const t=new Uint8Array(e);let s=0;for(let r=0;r<e;r++)t[r]=i[0][s++],s===i[0].length&&(i.shift(),s=0);return i.length&&s<i[0].length&&(i[0]=i[0].slice(s)),t}function xr(i,e){wt||(wt=new TextDecoder);const t=[];let s=0,r=-1,n=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(s===0){if(Je(t)<1)break;const u=Ze(t,1);n=(u[0]&128)===128,r=u[0]&127,r<126?s=3:r===126?s=1:s=2}else if(s===1){if(Je(t)<2)break;const u=Ze(t,2);r=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),s=3}else if(s===2){if(Je(t)<8)break;const u=Ze(t,8),d=new DataView(u.buffer,u.byteOffset,u.length),_=d.getUint32(0);if(_>Math.pow(2,21)-1){a.enqueue(Pt);break}r=_*Math.pow(2,32)+d.getUint32(4),s=3}else{if(Je(t)<r)break;const u=Ze(t,r);a.enqueue(Vt(n?u:wt.decode(u),e)),s=0}if(r===0||r>i){a.enqueue(Pt);break}}}})}const qs=4;function q(i){if(i)return Pr(i)}function Pr(i){for(var e in q.prototype)i[e]=q.prototype[e];return i}q.prototype.on=q.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};q.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};q.prototype.off=q.prototype.removeListener=q.prototype.removeAllListeners=q.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var s,r=0;r<t.length;r++)if(s=t[r],s===e||s.fn===e){t.splice(r,1);break}return t.length===0&&delete this._callbacks["$"+i],this};q.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,r=t.length;s<r;++s)t[s].apply(this,e)}return this};q.prototype.emitReserved=q.prototype.emit;q.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};q.prototype.hasListeners=function(i){return!!this.listeners(i).length};const lt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Z=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),$r="arraybuffer";function Ms(i,...e){return e.reduce((t,s)=>(i.hasOwnProperty(s)&&(t[s]=i[s]),t),{})}const Lr=Z.setTimeout,Ir=Z.clearTimeout;function ft(i,e){e.useNativeTimers?(i.setTimeoutFn=Lr.bind(Z),i.clearTimeoutFn=Ir.bind(Z)):(i.setTimeoutFn=Z.setTimeout.bind(Z),i.clearTimeoutFn=Z.clearTimeout.bind(Z))}const Br=1.33;function qr(i){return typeof i=="string"?Mr(i):Math.ceil((i.byteLength||i.size)*Br)}function Mr(i){let e=0,t=0;for(let s=0,r=i.length;s<r;s++)e=i.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function Ds(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Dr(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function Fr(i){let e={},t=i.split("&");for(let s=0,r=t.length;s<r;s++){let n=t[s].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}class Kr extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class Ht extends q{constructor(e){super(),this.writable=!1,ft(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Kr(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Vt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Dr(e);return t.length?"?"+t:""}}class Ur extends Ht{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Nr(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Or(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Ds()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let Fs=!1;try{Fs=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Vr=Fs;function Hr(){}class Qr extends Ur{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(r,n)=>{this.onError("xhr post error",r,n)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class he extends q{constructor(e,t,s){super(),this.createRequest=e,ft(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=Ms(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&s.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var r;s.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=he.requestsCount++,he.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Hr,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete he.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}he.requestsCount=0;he.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Es);else if(typeof addEventListener=="function"){const i="onpagehide"in Z?"pagehide":"unload";addEventListener(i,Es,!1)}}function Es(){for(let i in he.requests)he.requests.hasOwnProperty(i)&&he.requests[i].abort()}const Wr=function(){const i=Ks({xdomain:!1});return i&&i.responseType!==null}();class Yr extends Qr{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Wr&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new he(Ks,this.uri(),e)}}function Ks(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Vr))return new XMLHttpRequest}catch{}if(!e)try{return new Z[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Us=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Gr extends Ht{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=Us?{}:Ms(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;Ut(s,this.supportsBinary,n=>{try{this.doWrite(s,n)}catch{}r&&lt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Ds()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const kt=Z.WebSocket||Z.MozWebSocket;class jr extends Gr{createSocket(e,t,s){return Us?new kt(e,t,s):t?new kt(e,t):new kt(e)}doWrite(e,t){this.ws.send(t)}}class zr extends Ht{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=xr(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),r=Rr();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const n=()=>{s.read().then(({done:a,value:u})=>{a||(this.onPacket(u),n())}).catch(a=>{})};n();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;this._writer.write(s).then(()=>{r&&lt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Xr={websocket:jr,webtransport:zr,polling:Yr},Jr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Zr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function $t(i){if(i.length>8e3)throw"URI too long";const e=i,t=i.indexOf("["),s=i.indexOf("]");t!=-1&&s!=-1&&(i=i.substring(0,t)+i.substring(t,s).replace(/:/g,";")+i.substring(s,i.length));let r=Jr.exec(i||""),n={},o=14;for(;o--;)n[Zr[o]]=r[o]||"";return t!=-1&&s!=-1&&(n.source=e,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=en(n,n.path),n.queryKey=tn(n,n.query),n}function en(i,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function tn(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,r,n){r&&(t[r]=n)}),t}const Lt=typeof addEventListener=="function"&&typeof removeEventListener=="function",it=[];Lt&&addEventListener("offline",()=>{it.forEach(i=>i())},!1);class ve extends q{constructor(e,t){if(super(),this.binaryType=$r,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=$t(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=$t(t.host).host);ft(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const r=s.prototype.name;this.transports.push(r),this._transportsByName[r]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Fr(this.opts.query)),Lt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},it.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=qs,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&ve.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",ve.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(t+=qr(r)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,lt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,r){if(typeof t=="function"&&(r=t,t=void 0),typeof s=="function"&&(r=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const n={type:e,data:t,options:s};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(ve.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Lt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=it.indexOf(this._offlineEventListener);s!==-1&&it.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ve.protocol=qs;class sn extends ve{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;ve.priorWebsocketSuccess=!1;const r=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",v=>{if(!s)if(v.type==="pong"&&v.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ve.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(_(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function n(){s||(s=!0,_(),t.close(),t=null)}const o=v=>{const p=new Error("probe error: "+v);p.transport=t.name,n(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function u(){o("socket closed")}function d(v){t&&v.name!==t.name&&n()}const _=()=>{t.removeListener("open",r),t.removeListener("error",o),t.removeListener("close",a),this.off("close",u),this.off("upgrading",d)};t.once("open",r),t.once("error",o),t.once("close",a),this.once("close",u),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let rn=class extends sn{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(r=>Xr[r]).filter(r=>!!r)),super(e,s)}};function nn(i,e="",t){let s=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),s=$t(i)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const n=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+n+":"+s.port+e,s.href=s.protocol+"://"+n+(t&&t.port===s.port?"":":"+s.port),s}const on=typeof ArrayBuffer=="function",an=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,Vs=Object.prototype.toString,cn=typeof Blob=="function"||typeof Blob<"u"&&Vs.call(Blob)==="[object BlobConstructor]",hn=typeof File=="function"||typeof File<"u"&&Vs.call(File)==="[object FileConstructor]";function Qt(i){return on&&(i instanceof ArrayBuffer||an(i))||cn&&i instanceof Blob||hn&&i instanceof File}function rt(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,s=i.length;t<s;t++)if(rt(i[t]))return!0;return!1}if(Qt(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return rt(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&rt(i[t]))return!0;return!1}function ln(i){const e=[],t=i.data,s=i;return s.data=It(t,e),s.attachments=e.length,{packet:s,buffers:e}}function It(i,e){if(!i)return i;if(Qt(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let s=0;s<i.length;s++)t[s]=It(i[s],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=It(i[s],e));return t}return i}function fn(i,e){return i.data=Bt(i.data,e),delete i.attachments,i}function Bt(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=Bt(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=Bt(i[t],e));return i}const un=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],pn=5;var O;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class dn{constructor(e){this.replacer=e}encode(e){return(e.type===O.EVENT||e.type===O.ACK)&&rt(e)?this.encodeAsBinary({type:e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===O.BINARY_EVENT||e.type===O.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ln(e),s=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(s),r}}function ws(i){return Object.prototype.toString.call(i)==="[object Object]"}class Wt extends q{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===O.BINARY_EVENT;s||t.type===O.BINARY_ACK?(t.type=s?O.EVENT:O.ACK,this.reconstructor=new _n(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Qt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(O[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===O.BINARY_EVENT||s.type===O.BINARY_ACK){const n=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(n,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){const n=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(n,t)}else s.nsp="/";const r=e.charAt(t+1);if(r!==""&&Number(r)==r){const n=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(Wt.isPayloadValid(s.type,n))s.data=n;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case O.CONNECT:return ws(t);case O.DISCONNECT:return t===void 0;case O.CONNECT_ERROR:return typeof t=="string"||ws(t);case O.EVENT:case O.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&un.indexOf(t[0])===-1);case O.ACK:case O.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class _n{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=fn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const gn=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Wt,Encoder:dn,get PacketType(){return O},protocol:pn},Symbol.toStringTag,{value:"Module"}));function re(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const mn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Hs extends q{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[re(e,"open",this.onopen.bind(this)),re(e,"packet",this.onpacket.bind(this)),re(e,"error",this.onerror.bind(this)),re(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,r,n;if(mn.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:O.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const _=this.ids++,v=t.pop();this._registerAckCallback(_,v),o.id=_}const a=(r=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||r===void 0?void 0:r.writable,u=this.connected&&!(!((n=this.io.engine)===null||n===void 0)&&n._hasPingExpired());return this.flags.volatile&&!a||(u?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s;const r=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(r===void 0){this.acks[e]=t;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},r),o=(...a)=>{this.io.clearTimeoutFn(n),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,r)=>{const n=(o,a)=>o?r(o):s(a);n.withError=!0,t.push(n),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...n)=>s!==this._queue[0]?void 0:(r!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(r)):(this._queue.shift(),t&&t(null,...n)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:O.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case O.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(e);break;case O.ACK:case O.BINARY_ACK:this.onack(e);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...r){s||(s=!0,t.packet({type:O.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function Re(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}Re.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-t:i+t}return Math.min(i,this.max)|0};Re.prototype.reset=function(){this.attempts=0};Re.prototype.setMin=function(i){this.ms=i};Re.prototype.setMax=function(i){this.max=i};Re.prototype.setJitter=function(i){this.jitter=i};class qt extends q{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,ft(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Re({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||gn;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new rn(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=re(t,"open",function(){s.onopen(),e&&e()}),n=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=re(t,"error",n);if(this._timeout!==!1){const a=this._timeout,u=this.setTimeoutFn(()=>{r(),n(new Error("timeout")),t.close()},a);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(re(e,"ping",this.onping.bind(this)),re(e,"data",this.ondata.bind(this)),re(e,"error",this.onerror.bind(this)),re(e,"close",this.onclose.bind(this)),re(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){lt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Hs(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Fe={};function nt(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=nn(i,e.path||"/socket.io"),s=t.source,r=t.id,n=t.path,o=Fe[r]&&n in Fe[r].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let u;return a?u=new qt(s,e):(Fe[r]||(Fe[r]=new qt(s,e)),u=Fe[r]),t.query&&!e.query&&(e.query=t.queryKey),u.socket(t.path,e)}Object.assign(nt,{Manager:qt,Socket:Hs,io:nt,connect:nt});function vn(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function yn(i,e,t,s,r){const n={move:i,variations:r};return e&&(n.suffix=e),t&&(n.nag=t),s!==null&&(n.comment=s),n}function bn(...i){const[e,...t]=i;let s=e;for(const r of t)r!==null&&(s.variations=[r,...r.variations],r.variations=[],s=r);return e}function En(i,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const s=t.variations[0];if(!s){t.comment=e.marker.comment;break}t=s}}return{headers:i,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function wn(i,e){function t(){this.constructor=i}t.prototype=e.prototype,i.prototype=new t}function Ne(i,e,t,s){var r=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(r,Ne.prototype),r.expected=e,r.found=t,r.location=s,r.name="SyntaxError",r}wn(Ne,Error);function At(i,e,t){return t=t||" ",i.length>e?i:(e-=i.length,t+=t.repeat(e),i+t.slice(0,e))}Ne.prototype.format=function(i){var e="Error: "+this.message;if(this.location){var t=null,s;for(s=0;s<i.length;s++)if(i[s].source===this.location.source){t=i[s].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,o=this.location.source+":"+n.line+":"+n.column;if(t){var a=this.location.end,u=At("",n.line.toString().length," "),d=t[r.line-1],_=r.line===a.line?a.column:d.length+1,v=_-r.column||1;e+=`
 --> `+o+`
`+u+` |
`+n.line+" | "+d+`
`+u+" | "+At("",r.column-1," ")+At("",v,"^")}else e+=`
 at `+o}return e};Ne.buildMessage=function(i,e){var t={literal:function(d){return'"'+r(d.text)+'"'},class:function(d){var _=d.parts.map(function(v){return Array.isArray(v)?n(v[0])+"-"+n(v[1]):n(v)});return"["+(d.inverted?"^":"")+_.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(d){return d.description}};function s(d){return d.charCodeAt(0).toString(16).toUpperCase()}function r(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(_){return"\\x0"+s(_)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(_){return"\\x"+s(_)})}function n(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(_){return"\\x0"+s(_)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(_){return"\\x"+s(_)})}function o(d){return t[d.type](d)}function a(d){var _=d.map(o),v,p;if(_.sort(),_.length>0){for(v=1,p=1;v<_.length;v++)_[v-1]!==_[v]&&(_[p]=_[v],p++);_.length=p}switch(_.length){case 1:return _[0];case 2:return _[0]+" or "+_[1];default:return _.slice(0,-1).join(", ")+", or "+_[_.length-1]}}function u(d){return d?'"'+r(d)+'"':"end of input"}return"Expected "+a(i)+" but "+u(e)+" found."};function kn(i,e){e=e!==void 0?e:{};var t={},s=e.grammarSource,r={pgn:es},n=es,o="[",a='"',u="]",d=".",_="O-O-O",v="O-O",p="0-0-0",m="0-0",y="$",T="{",L="}",V=";",Q="(",D=")",S="1-0",R="0-1",pe="1/2-1/2",fe="*",Y=/^[a-zA-Z]/,ye=/^[^"]/,ee=/^[0-9]/,z=/^[.]/,ne=/^[a-zA-Z1-8\-=]/,xe=/^[+#]/,Pe=/^[!?]/,Qe=/^[^}]/,Te=/^[^\r\n]/,We=/^[ \t\r\n]/,$e=X("tag pair"),Ye=K("[",!1),k=K('"',!1),I=K("]",!1),$=X("tag name"),F=oe([["a","z"],["A","Z"]],!1,!1),te=X("tag value"),be=oe(['"'],!0,!1),Le=X("move number"),ue=oe([["0","9"]],!1,!1),Ee=K(".",!1),Ie=oe(["."],!1,!1),pt=X("standard algebraic notation"),dt=K("O-O-O",!1),we=K("O-O",!1),Be=K("0-0-0",!1),Ws=K("0-0",!1),Yt=oe([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Ys=oe(["+","#"],!1,!1),Gs=X("suffix annotation"),Gt=oe(["!","?"],!1,!1),js=X("NAG"),zs=K("$",!1),Xs=X("brace comment"),Js=K("{",!1),jt=oe(["}"],!0,!1),Zs=K("}",!1),ei=X("rest of line comment"),ti=K(";",!1),zt=oe(["\r",`
`],!0,!1),si=X("variation"),ii=K("(",!1),ri=K(")",!1),ni=X("game termination marker"),oi=K("1-0",!1),ai=K("0-1",!1),ci=K("1/2-1/2",!1),hi=K("*",!1),li=X("whitespace"),Xt=oe([" ","	","\r",`
`],!1,!1),fi=function(c,l){return En(c,l)},ui=function(c){return Object.fromEntries(c)},pi=function(c,l){return[c,l]},di=function(c,l){return{root:c,marker:l}},_i=function(c,l){return bn(vn(c),...l.flat())},gi=function(c,l,f,E,w){return yn(c,l,f,E,w)},mi=function(c){return c},vi=function(c){return c.replace(/[\r\n]+/g," ")},yi=function(c){return c.trim()},bi=function(c){return c},Ei=function(c,l){return{result:c,comment:l}},h=e.peg$currPos|0,Oe=[{line:1,column:1}],se=h,Ge=e.peg$maxFailExpected||[],g=e.peg$silentFails|0,qe;if(e.startRule){if(!(e.startRule in r))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');n=r[e.startRule]}function K(c,l){return{type:"literal",text:c,ignoreCase:l}}function oe(c,l,f){return{type:"class",parts:c,inverted:l,ignoreCase:f}}function wi(){return{type:"end"}}function X(c){return{type:"other",description:c}}function Jt(c){var l=Oe[c],f;if(l)return l;if(c>=Oe.length)f=Oe.length-1;else for(f=c;!Oe[--f];);for(l=Oe[f],l={line:l.line,column:l.column};f<c;)i.charCodeAt(f)===10?(l.line++,l.column=1):l.column++,f++;return Oe[c]=l,l}function Zt(c,l,f){var E=Jt(c),w=Jt(l),x={source:s,start:{offset:c,line:E.line,column:E.column},end:{offset:l,line:w.line,column:w.column}};return x}function b(c){h<se||(h>se&&(se=h,Ge=[]),Ge.push(c))}function ki(c,l,f){return new Ne(Ne.buildMessage(c,l),c,l,f)}function es(){var c,l,f;return c=h,l=Ai(),f=Ti(),c=fi(l,f),c}function Ai(){var c,l,f;for(c=h,l=[],f=ts();f!==t;)l.push(f),f=ts();return f=G(),c=ui(l),c}function ts(){var c,l,f,E,w,x,ke;return g++,c=h,G(),i.charCodeAt(h)===91?(l=o,h++):(l=t,g===0&&b(Ye)),l!==t?(G(),f=Ci(),f!==t?(G(),i.charCodeAt(h)===34?(E=a,h++):(E=t,g===0&&b(k)),E!==t?(w=Si(),i.charCodeAt(h)===34?(x=a,h++):(x=t,g===0&&b(k)),x!==t?(G(),i.charCodeAt(h)===93?(ke=u,h++):(ke=t,g===0&&b(I)),ke!==t?c=pi(f,w):(h=c,c=t)):(h=c,c=t)):(h=c,c=t)):(h=c,c=t)):(h=c,c=t),g--,c===t&&g===0&&b($e),c}function Ci(){var c,l,f;if(g++,c=h,l=[],f=i.charAt(h),Y.test(f)?h++:(f=t,g===0&&b(F)),f!==t)for(;f!==t;)l.push(f),f=i.charAt(h),Y.test(f)?h++:(f=t,g===0&&b(F));else l=t;return l!==t?c=i.substring(c,h):c=l,g--,c===t&&(l=t,g===0&&b($)),c}function Si(){var c,l,f;for(g++,c=h,l=[],f=i.charAt(h),ye.test(f)?h++:(f=t,g===0&&b(be));f!==t;)l.push(f),f=i.charAt(h),ye.test(f)?h++:(f=t,g===0&&b(be));return c=i.substring(c,h),g--,l=t,g===0&&b(te),c}function Ti(){var c,l,f;return c=h,l=ss(),G(),f=$i(),f===t&&(f=null),G(),c=di(l,f),c}function ss(){var c,l,f,E;for(c=h,l=_t(),l===t&&(l=null),f=[],E=is();E!==t;)f.push(E),E=is();return c=_i(l,f),c}function is(){var c,l,f,E,w,x,ke,je;if(c=h,G(),Oi(),G(),l=Ni(),l!==t){for(f=Ri(),f===t&&(f=null),E=[],w=rs();w!==t;)E.push(w),w=rs();for(w=G(),x=_t(),x===t&&(x=null),ke=[],je=ns();je!==t;)ke.push(je),je=ns();c=gi(l,f,E,x,ke)}else h=c,c=t;return c}function Oi(){var c,l,f,E,w,x;for(g++,c=h,l=[],f=i.charAt(h),ee.test(f)?h++:(f=t,g===0&&b(ue));f!==t;)l.push(f),f=i.charAt(h),ee.test(f)?h++:(f=t,g===0&&b(ue));if(i.charCodeAt(h)===46?(f=d,h++):(f=t,g===0&&b(Ee)),f!==t){for(E=G(),w=[],x=i.charAt(h),z.test(x)?h++:(x=t,g===0&&b(Ie));x!==t;)w.push(x),x=i.charAt(h),z.test(x)?h++:(x=t,g===0&&b(Ie));l=[l,f,E,w],c=l}else h=c,c=t;return g--,c===t&&(l=t,g===0&&b(Le)),c}function Ni(){var c,l,f,E,w,x;if(g++,c=h,l=h,i.substr(h,5)===_?(f=_,h+=5):(f=t,g===0&&b(dt)),f===t&&(i.substr(h,3)===v?(f=v,h+=3):(f=t,g===0&&b(we)),f===t&&(i.substr(h,5)===p?(f=p,h+=5):(f=t,g===0&&b(Be)),f===t&&(i.substr(h,3)===m?(f=m,h+=3):(f=t,g===0&&b(Ws)),f===t))))if(f=h,E=i.charAt(h),Y.test(E)?h++:(E=t,g===0&&b(F)),E!==t){if(w=[],x=i.charAt(h),ne.test(x)?h++:(x=t,g===0&&b(Yt)),x!==t)for(;x!==t;)w.push(x),x=i.charAt(h),ne.test(x)?h++:(x=t,g===0&&b(Yt));else w=t;w!==t?(E=[E,w],f=E):(h=f,f=t)}else h=f,f=t;return f!==t?(E=i.charAt(h),xe.test(E)?h++:(E=t,g===0&&b(Ys)),E===t&&(E=null),f=[f,E],l=f):(h=l,l=t),l!==t?c=i.substring(c,h):c=l,g--,c===t&&(l=t,g===0&&b(pt)),c}function Ri(){var c,l,f;for(g++,c=h,l=[],f=i.charAt(h),Pe.test(f)?h++:(f=t,g===0&&b(Gt));f!==t;)l.push(f),l.length>=2?f=t:(f=i.charAt(h),Pe.test(f)?h++:(f=t,g===0&&b(Gt)));return l.length<1?(h=c,c=t):c=l,g--,c===t&&(l=t,g===0&&b(Gs)),c}function rs(){var c,l,f,E,w;if(g++,c=h,G(),i.charCodeAt(h)===36?(l=y,h++):(l=t,g===0&&b(zs)),l!==t){if(f=h,E=[],w=i.charAt(h),ee.test(w)?h++:(w=t,g===0&&b(ue)),w!==t)for(;w!==t;)E.push(w),w=i.charAt(h),ee.test(w)?h++:(w=t,g===0&&b(ue));else E=t;E!==t?f=i.substring(f,h):f=E,f!==t?c=mi(f):(h=c,c=t)}else h=c,c=t;return g--,c===t&&g===0&&b(js),c}function _t(){var c;return c=xi(),c===t&&(c=Pi()),c}function xi(){var c,l,f,E,w;if(g++,c=h,i.charCodeAt(h)===123?(l=T,h++):(l=t,g===0&&b(Js)),l!==t){for(f=h,E=[],w=i.charAt(h),Qe.test(w)?h++:(w=t,g===0&&b(jt));w!==t;)E.push(w),w=i.charAt(h),Qe.test(w)?h++:(w=t,g===0&&b(jt));f=i.substring(f,h),i.charCodeAt(h)===125?(E=L,h++):(E=t,g===0&&b(Zs)),E!==t?c=vi(f):(h=c,c=t)}else h=c,c=t;return g--,c===t&&(l=t,g===0&&b(Xs)),c}function Pi(){var c,l,f,E,w;if(g++,c=h,i.charCodeAt(h)===59?(l=V,h++):(l=t,g===0&&b(ti)),l!==t){for(f=h,E=[],w=i.charAt(h),Te.test(w)?h++:(w=t,g===0&&b(zt));w!==t;)E.push(w),w=i.charAt(h),Te.test(w)?h++:(w=t,g===0&&b(zt));f=i.substring(f,h),c=yi(f)}else h=c,c=t;return g--,c===t&&(l=t,g===0&&b(ei)),c}function ns(){var c,l,f,E;return g++,c=h,G(),i.charCodeAt(h)===40?(l=Q,h++):(l=t,g===0&&b(ii)),l!==t?(f=ss(),f!==t?(G(),i.charCodeAt(h)===41?(E=D,h++):(E=t,g===0&&b(ri)),E!==t?c=bi(f):(h=c,c=t)):(h=c,c=t)):(h=c,c=t),g--,c===t&&g===0&&b(si),c}function $i(){var c,l,f;return g++,c=h,i.substr(h,3)===S?(l=S,h+=3):(l=t,g===0&&b(oi)),l===t&&(i.substr(h,3)===R?(l=R,h+=3):(l=t,g===0&&b(ai)),l===t&&(i.substr(h,7)===pe?(l=pe,h+=7):(l=t,g===0&&b(ci)),l===t&&(i.charCodeAt(h)===42?(l=fe,h++):(l=t,g===0&&b(hi))))),l!==t?(G(),f=_t(),f===t&&(f=null),c=Ei(l,f)):(h=c,c=t),g--,c===t&&(l=t,g===0&&b(ni)),c}function G(){var c,l;for(g++,c=[],l=i.charAt(h),We.test(l)?h++:(l=t,g===0&&b(Xt));l!==t;)c.push(l),l=i.charAt(h),We.test(l)?h++:(l=t,g===0&&b(Xt));return g--,l=t,g===0&&b(li),c}if(qe=n(),e.peg$library)return{peg$result:qe,peg$currPos:h,peg$FAILED:t,peg$maxFailExpected:Ge,peg$maxFailPos:se};if(qe!==t&&h===i.length)return qe;throw qe!==t&&h<i.length&&b(wi()),ki(Ge,se<i.length?i.charAt(se):null,se<i.length?Zt(se,se+1):Zt(se,se))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const ot=0xffffffffffffffffn;function Ct(i,e){return(i<<e|i>>64n-e)&0xffffffffffffffffn}function ks(i,e){return i*e&ot}function An(i){return function(){let e=BigInt(i&ot),t=BigInt(i>>64n&ot);const s=ks(Ct(ks(e,5n),7n),9n);return t^=e,e=(Ct(e,24n)^t^t<<16n)&ot,t=Ct(t,37n),i=t<<64n|e,s}}const ut=An(0xa187eb39cdcaed8f31c4b365b102e01en),Cn=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>ut()))),Sn=Array.from({length:8},()=>ut()),Tn=Array.from({length:16},()=>ut()),St=ut(),W="w",j="b",B="p",Mt="n",at="b",Ve="r",me="q",M="k",Tt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class et{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:s,piece:r,from:n,to:o,flags:a,captured:u,promotion:d}=t,_=U(n),v=U(o);this.color=s,this.piece=r,this.from=_,this.to=v,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=_+v,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const p in C)C[p]&a&&(this.flags+=Ce[p]);u&&(this.captured=u),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(Ce.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ce.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ce.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ce.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ce.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ce.BIG_PAWN)>-1}}const H=-1,Ce={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},C={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Dt={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},On={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Nn={...Dt,...On},A={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Ot={b:[16,32,17,15],w:[-16,-32,-17,-15]},As={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Rn=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],xn=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Pn={p:1,n:2,b:4,r:8,q:16,k:32},$n="pnbrqkPNBRQK",Cs=[Mt,at,Ve,me],Ln=7,In=6,Bn=1,qn=0,tt={[M]:C.KSIDE_CASTLE,[me]:C.QSIDE_CASTLE},de={w:[{square:A.a1,flag:C.QSIDE_CASTLE},{square:A.h1,flag:C.KSIDE_CASTLE}],b:[{square:A.a8,flag:C.QSIDE_CASTLE},{square:A.h8,flag:C.KSIDE_CASTLE}]},Mn={b:Bn,w:In},Nt="--";function Se(i){return i>>4}function He(i){return i&15}function Qs(i){return"0123456789".indexOf(i)!==-1}function U(i){const e=He(i),t=Se(i);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function Ke(i){return i===W?j:W}function Dn(i){const e=i.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=e[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<r.length;o++){let a=0,u=!1;for(let d=0;d<r[o].length;d++)if(Qs(r[o][d])){if(u)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(r[o][d],10),u=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[o][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,u=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of n){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(r[0]+r[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Fn(i,e){const t=i.from,s=i.to,r=i.piece;let n=0,o=0,a=0;for(let u=0,d=e.length;u<d;u++){const _=e[u].from,v=e[u].to,p=e[u].piece;r===p&&t!==_&&s===v&&(n++,Se(t)===Se(_)&&o++,He(t)===He(_)&&a++)}return n>0?o>0&&a>0?U(t):a>0?U(t).charAt(1):U(t).charAt(0):""}function _e(i,e,t,s,r,n=void 0,o=C.NORMAL){const a=Se(s);if(r===B&&(a===Ln||a===qn))for(let u=0;u<Cs.length;u++){const d=Cs[u];i.push({color:e,from:t,to:s,piece:r,captured:n,promotion:d,flags:o|C.PROMOTION})}else i.push({color:e,from:t,to:s,piece:r,captured:n,flags:o})}function Ss(i){let e=i.charAt(0);return e>="a"&&e<="h"?i.match(/[a-h]\d.*[a-h]\d/)?void 0:B:(e=e.toLowerCase(),e==="o"?M:e)}function Rt(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Kn{_board=new Array(128);_turn=W;_header={};_kings={w:H,b:H};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=Tt,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:H,b:H},this._turn=W,this._castling={w:0,b:0},this._epSquare=H,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...Nn},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6){const a=["-","-","0","1"];e=r.concat(a.slice(-(6-r.length))).join(" ")}if(r=e.split(/\s+/),!t){const{ok:a,error:u}=Dn(e);if(!a)throw new Error(u)}const n=r[0];let o=0;this.clear({preserveHeaders:s});for(let a=0;a<n.length;a++){const u=n.charAt(a);if(u==="/")o+=8;else if(Qs(u))o+=parseInt(u,10);else{const d=u<"a"?W:j;this._put({type:u.toLowerCase(),color:d},U(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=C.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=C.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=C.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=C.QSIDE_CASTLE),this._epSquare=r[3]==="-"?H:A[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,s="";for(let o=A.a8;o<=A.h1;o++){if(this._board[o]){t>0&&(s+=t,t=0);const{color:a,type:u}=this._board[o];s+=a===W?u.toUpperCase():u.toLowerCase()}else t++;o+1&136&&(t>0&&(s+=t),o!==A.h1&&(s+="/"),t=0,o+=8)}let r="";this._castling[W]&C.KSIDE_CASTLE&&(r+="K"),this._castling[W]&C.QSIDE_CASTLE&&(r+="Q"),this._castling[j]&C.KSIDE_CASTLE&&(r+="k"),this._castling[j]&C.QSIDE_CASTLE&&(r+="q"),r=r||"-";let n="-";if(this._epSquare!==H)if(e)n=U(this._epSquare);else{const o=this._epSquare+(this._turn===W?16:-16),a=[o+1,o-1];for(const u of a){if(u&136)continue;const d=this._turn;if(this._board[u]?.color===d&&this._board[u]?.type===B){this._makeMove({color:d,from:u,to:this._epSquare,piece:B,captured:B,flags:C.EP_CAPTURE});const _=!this._isKingAttacked(d);if(this._undoMove(),_){n=U(this._epSquare);break}}}}return[s,this._turn,r,n,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:s}=this._board[e],r={w:0,b:1}[t],n={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Cn[r][n][e]}_epKey(){return this._epSquare===H?0n:Sn[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return Tn[e]}_computeHash(){let e=0n;for(let t=A.a8;t<=A.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=St),e}_updateSetup(e){this._history.length>0||(e!==Tt?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Tt)}get(e){return this._board[A[e]]}findPiece(e){const t=[];for(let s=A.a8;s<=A.h1;s++){if(s&136){s+=7;continue}!this._board[s]||this._board[s]?.color!==e.color||this._board[s].color===e.color&&this._board[s].type===e.type&&t.push(U(s))}return t}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},s){if($n.indexOf(e.toLowerCase())===-1||!(s in A))return!1;const r=A[s];if(e==M&&!(this._kings[t]==H||this._kings[t]==r))return!1;const n=this._board[r];return n&&n.type===M&&(this._kings[n.color]=H),this._set(r,{type:e,color:t}),e===M&&(this._kings[t]=r),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(A[e]),t&&t.type===M&&(this._kings[t.color]=H),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[A.e1]?.type===M&&this._board[A.e1]?.color===W,t=this._board[A.e8]?.type===M&&this._board[A.e8]?.color===j;(!e||this._board[A.a1]?.type!==Ve||this._board[A.a1]?.color!==W)&&(this._castling.w&=-65),(!e||this._board[A.h1]?.type!==Ve||this._board[A.h1]?.color!==W)&&(this._castling.w&=-33),(!t||this._board[A.a8]?.type!==Ve||this._board[A.a8]?.color!==j)&&(this._castling.b&=-65),(!t||this._board[A.h8]?.type!==Ve||this._board[A.h8]?.color!==j)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===H)return;const e=this._epSquare+(this._turn===W?-16:16),t=this._epSquare+(this._turn===W?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[t]?.color!==Ke(this._turn)||this._board[t]?.type!==B){this._hash^=this._epKey(),this._epSquare=H;return}const r=n=>!(n&136)&&this._board[n]?.color===this._turn&&this._board[n]?.type===B;s.some(r)||(this._hash^=this._epKey(),this._epSquare=H)}_attacked(e,t,s){const r=[];for(let n=A.a8;n<=A.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==e)continue;const o=this._board[n],a=n-t;if(a===0)continue;const u=a+119;if(Rn[u]&Pn[o.type]){if(o.type===B){if(a>0&&o.color===W||a<=0&&o.color===j)if(s)r.push(U(n));else return!0;continue}if(o.type==="n"||o.type==="k")if(s){r.push(U(n));continue}else return!0;const d=xn[u];let _=n+d,v=!1;for(;_!==t;){if(this._board[_]!=null){v=!0;break}_+=d}if(!v)if(s){r.push(U(n));continue}else return!0}}return s?r:!1}attackers(e,t){return t?this._attacked(t,A[e],!0):this._attacked(this._turn,A[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(Ke(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,A[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,r=0;for(let n=A.a8;n<=A.h1;n++){if(r=(r+1)%2,n&136){n+=7;continue}const o=this._board[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===at&&t.push(r),s++)}if(s===2)return!0;if(s===3&&(e[at]===1||e[Mt]===1))return!0;if(s===e[at]+2){let n=0;const o=t.length;for(let a=0;a<o;a++)n+=t[a];if(n===0||n===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const r=this._moves({square:t,piece:s});return e?r.map(n=>new et(this,n)):r.map(n=>this._moveToSan(n,r))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){const r=s?s.toLowerCase():void 0,n=t?.toLowerCase(),o=[],a=this._turn,u=Ke(a);let d=A.a8,_=A.h1,v=!1;if(r)if(r in A)d=_=A[r],v=!0;else return[];for(let m=d;m<=_;m++){if(m&136){m+=7;continue}if(!this._board[m]||this._board[m].color===u)continue;const{type:y}=this._board[m];let T;if(y===B){if(n&&n!==y)continue;T=m+Ot[a][0],this._board[T]||(_e(o,a,m,T,B),T=m+Ot[a][1],Mn[a]===Se(m)&&!this._board[T]&&_e(o,a,m,T,B,void 0,C.BIG_PAWN));for(let L=2;L<4;L++)T=m+Ot[a][L],!(T&136)&&(this._board[T]?.color===u?_e(o,a,m,T,B,this._board[T].type,C.CAPTURE):T===this._epSquare&&_e(o,a,m,T,B,B,C.EP_CAPTURE))}else{if(n&&n!==y)continue;for(let L=0,V=As[y].length;L<V;L++){const Q=As[y][L];for(T=m;T+=Q,!(T&136);){if(!this._board[T])_e(o,a,m,T,y);else{if(this._board[T].color===a)break;_e(o,a,m,T,y,this._board[T].type,C.CAPTURE);break}if(y===Mt||y===M)break}}}}if((n===void 0||n===M)&&(!v||_===this._kings[a])){if(this._castling[a]&C.KSIDE_CASTLE){const m=this._kings[a],y=m+2;!this._board[m+1]&&!this._board[y]&&!this._attacked(u,this._kings[a])&&!this._attacked(u,m+1)&&!this._attacked(u,y)&&_e(o,a,this._kings[a],y,M,void 0,C.KSIDE_CASTLE)}if(this._castling[a]&C.QSIDE_CASTLE){const m=this._kings[a],y=m-2;!this._board[m-1]&&!this._board[m-2]&&!this._board[m-3]&&!this._attacked(u,this._kings[a])&&!this._attacked(u,m-1)&&!this._attacked(u,y)&&_e(o,a,this._kings[a],y,M,void 0,C.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return o;const p=[];for(let m=0,y=o.length;m<y;m++)this._makeMove(o[m]),this._isKingAttacked(a)||p.push(o[m]),this._undoMove();return p}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(e===null)s=this._moveFromSan(Nt,t);else if(typeof e=="object"){const n=this._moves();for(let o=0,a=n.length;o<a;o++)if(e.from===U(n[o].from)&&e.to===U(n[o].to)&&(!("promotion"in n[o])||e.promotion===n[o].promotion)){s=n[o];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&s.flags&C.NULL_MOVE)throw new Error("Null move not allowed when in check");const r=new et(this,s);return this._makeMove(s),this._incPositionCount(),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){const t=this._turn,s=Ke(t);if(this._push(e),e.flags&C.NULL_MOVE){t===j&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=H;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&C.EP_CAPTURE&&(this._turn===j?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===M){if(this._kings[t]=e.to,e.flags&C.KSIDE_CASTLE){const r=e.to-1,n=e.to+1;this._movePiece(n,r)}else if(e.flags&C.QSIDE_CASTLE){const r=e.to+1,n=e.to-2;this._movePiece(n,r)}this._castling[t]=0}if(this._castling[t]){for(let r=0,n=de[t].length;r<n;r++)if(e.from===de[t][r].square&&this._castling[t]&de[t][r].flag){this._castling[t]^=de[t][r].flag;break}}if(this._castling[s]){for(let r=0,n=de[s].length;r<n;r++)if(e.to===de[s][r].square&&this._castling[s]&de[s][r].flag){this._castling[s]^=de[s][r].flag;break}}if(this._hash^=this._castlingKey(),e.flags&C.BIG_PAWN){let r;t===j?r=e.to-16:r=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===B&&this._board[e.to-1]?.color===s||!(e.to+1&136)&&this._board[e.to+1]?.type===B&&this._board[e.to+1]?.color===s?(this._epSquare=r,this._hash^=this._epKey()):this._epSquare=H}else this._epSquare=H;e.piece===B?this._halfMoves=0:e.flags&(C.CAPTURE|C.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===j&&this._moveNumber++,this._turn=s,this._hash^=St}undo(){const e=this._hash,t=this._undoMove();if(t){const s=new et(this,t);return this._decPositionCount(e),s}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=St;const s=this._turn,r=Ke(s);if(t.flags&C.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:s})),t.captured)if(t.flags&C.EP_CAPTURE){let n;s===j?n=t.to-16:n=t.to+16,this._set(n,{type:B,color:r})}else this._set(t.to,{type:t.captured,color:r});if(t.flags&(C.KSIDE_CASTLE|C.QSIDE_CASTLE)){let n,o;t.flags&C.KSIDE_CASTLE?(n=t.to+1,o=t.to-1):(n=t.to-2,o=t.to+1),this._movePiece(o,n)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let r=!1;for(const p in this._header)this._header[p]&&s.push(`[${p} "${this._header[p]}"]`+e),r=!0;r&&this._history.length&&s.push(e);const n=p=>{const m=this._comments[this.fen()];if(typeof m<"u"){const y=p.length>0?" ":"";p=`${p}${y}{${m}}`}return p},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let u="";for(o.length===0&&a.push(n(""));o.length>0;){u=n(u);const p=o.pop();if(!p)break;if(!this._history.length&&p.color==="b"){const m=`${this._moveNumber}. ...`;u=u?`${u} ${m}`:m}else p.color==="w"&&(u.length&&a.push(u),u=this._moveNumber+".");u=u+" "+this._moveToSan(p,this._moves({legal:!0})),this._makeMove(p)}if(u.length&&a.push(n(u)),a.push(this._header.Result||"*"),t===0)return s.join("")+a.join(" ");const d=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},_=function(p,m){for(const y of m.split(" "))if(y){if(p+y.length>t){for(;d();)p--;s.push(e),p=0}s.push(y),p+=y.length,s.push(" "),p++}return d()&&p--,p};let v=0;for(let p=0;p<a.length;p++){if(v+a[p].length>t&&a[p].includes("{")){v=_(v,a[p]);continue}v+a[p].length>t&&p!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),v=0):p!==0&&(s.push(" "),v++),s.push(a[p]),v+=a[p].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??Dt[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Dt[e]||null,!0):!1}getHeaders(){const e={};for(const[t,s]of Object.entries(this._header))s!==null&&(e[t]=s);return e}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(e=e.replace(new RegExp(s,"g"),`
`));const r=kn(e);this.reset();const n=r.headers;let o="";for(const d in n)d.toLowerCase()==="fen"&&(o=n[d]),this.header(d,n[d]);if(!t)o&&this.load(o,{preserveHeaders:!0});else if(n.SetUp==="1"){if(!("FEN"in n))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(n.FEN,{preserveHeaders:!0})}let a=r.root;for(;a;){if(a.move){const d=this._moveFromSan(a.move,t);if(d==null)throw new Error(`Invalid move in PGN: ${a.move}`);this._makeMove(d),this._incPositionCount()}a.comment!==void 0&&(this._comments[this.fen()]=a.comment),a=a.variations[0]}const u=r.result;u&&Object.keys(this._header).length&&this._header.Result!==u&&this.setHeader("Result",u)}_moveToSan(e,t){let s="";if(e.flags&C.KSIDE_CASTLE)s="O-O";else if(e.flags&C.QSIDE_CASTLE)s="O-O-O";else{if(e.flags&C.NULL_MOVE)return Nt;if(e.piece!==B){const r=Fn(e,t);s+=e.piece.toUpperCase()+r}e.flags&(C.CAPTURE|C.EP_CAPTURE)&&(e.piece===B&&(s+=U(e.from)[0]),s+="x"),s+=U(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){let s=Rt(e);if(t||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==Nt)return{color:this._turn,from:0,to:0,piece:"k",flags:C.NULL_MOVE};let r=Ss(s),n=this._moves({legal:!0,piece:r});for(let p=0,m=n.length;p<m;p++)if(s===Rt(this._moveToSan(n[p],n)))return n[p];if(t)return null;let o,a,u,d,_,v=!1;if(a=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(o=a[1],u=a[2],d=a[3],_=a[4],u.length==1&&(v=!0)):(a=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(o=a[1],u=a[2],d=a[3],_=a[4],u.length==1&&(v=!0))),r=Ss(s),n=this._moves({legal:!0,piece:o||r}),!d)return null;for(let p=0,m=n.length;p<m;p++)if(u){if((!o||o.toLowerCase()==n[p].piece)&&A[u]==n[p].from&&A[d]==n[p].to&&(!_||_.toLowerCase()==n[p].promotion))return n[p];if(v){const y=U(n[p].from);if((!o||o.toLowerCase()==n[p].piece)&&A[d]==n[p].to&&(u==y[0]||u==y[1])&&(!_||_.toLowerCase()==n[p].promotion))return n[p]}}else if(s===Rt(this._moveToSan(n[p],n)).replace("x",""))return n[p];return null}ascii(){let e=`   +------------------------+
`;for(let t=A.a8;t<=A.h1;t++){if(He(t)===0&&(e+=" "+"87654321"[Se(t)]+" |"),this._board[t]){const s=this._board[t].type,n=this._board[t].color===W?s.toUpperCase():s.toLowerCase();e+=" "+n+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const r=this._turn;for(let n=0,o=t.length;n<o;n++)this._makeMove(t[n]),this._isKingAttacked(r)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let s=A.a8;s<=A.h1;s++)this._board[s]==null?t.push(null):t.push({square:U(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in A){const t=A[e];return(Se(t)+He(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const r=t.pop();if(!r)break;e?s.push(new et(this,r)):s.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return s}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},s=r=>{r in this._comments&&(t[r]=this._comments[r])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const r=e.pop();if(!r)break;this._makeMove(r),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const r of[M,me])t[r]!==void 0&&(t[r]?this._castling[e]|=tt[r]:this._castling[e]&=~tt[r]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[M]===void 0||t[M]===s[M])&&(t[me]===void 0||t[me]===s[me])}getCastlingRights(e){return{[M]:(this._castling[e]&tt[M])!==0,[me]:(this._castling[e]&tt[me])!==0}}moveNumber(){return this._moveNumber}}var Un=ht('<div class="role-info svelte-12gnbi7">VocÃª joga com as <strong> </strong></div>'),Vn=ht('<img draggable="false" class="svelte-12gnbi7"/>'),Hn=ht("<div><!></div>"),Qn=ht('<main class="svelte-12gnbi7"><div class="menu svelte-12gnbi7"><input type="text" placeholder="ID da Sala" class="svelte-12gnbi7"/> <button class="svelte-12gnbi7">Entrar/Criar Jogo</button></div> <!> <div class="game-container svelte-12gnbi7"><div class="timers svelte-12gnbi7"><div> </div> <div> </div></div> <div class="status svelte-12gnbi7"> </div> <div></div></div></main>');function Jn(i,e){lr(e,!1);let t=ce([]),s=ce(null),r=ce([]),n=ce("Digite um ID de sala para entrar ou criar um jogo."),o=ce(!0),a=ce(null),u=ce("game123"),d=ce(600),_=ce(600),v,p,m=new Kn;const y={p:"bp.png",r:"br.png",n:"bn.png",b:"bb.png",q:"bq.png",k:"bk.png",P:"wp.png",R:"wr.png",N:"wn.png",B:"wb.png",Q:"wq.png",K:"wk.png"};function T(k){m.load(k);let I=[];return k.split(" ")[0].split("/").forEach($=>{let F=[];for(let te of $)if(isNaN(te))F.push(te);else for(let be=0;be<+te;be++)F.push(null);I.push(F)}),I}function L(k){k.isCheckmate?N(n,"Xeque-mate!"):k.isDraw?N(n,"Empate!"):k.inCheck?N(n,"Xeque nas "+(k.turn==="w"?"brancas":"pretas")+"!"):N(n,(k.turn==="w"?"Brancas":"Pretas")+" jogam")}function V(k,I){if(P(o))return;const $=String.fromCharCode(97+I)+(8-k);if(P(s))if(P(r).includes($))v.emit("move",{gameId:P(u),move:{from:P(s),to:$,promotion:"q"}}),N(s,null),N(r,[]);else{const F=m.get($);F&&F.color===P(a)?(N(s,$),N(r,m.moves({square:$,verbose:!0}).map(te=>te.to))):(N(s,null),N(r,[]))}else{const F=m.get($);F&&F.color===P(a)&&(N(s,$),N(r,m.moves({square:$,verbose:!0}).map(te=>te.to)))}}function Q(){if(!P(u)){alert("Por favor, insira um ID de sala.");return}v.emit("joinGame",P(u)),N(n,`Conectando Ã  sala: ${P(u)}...`)}function D(k){const I=Math.floor(k/60),$=k%60;return`${I}:${$<10?"0":""}${$}`}qi(()=>(p=new Audio("/sounds/move.mp3"),p.load(),v=nt("https://fe412fc1-e97a-4397-9b81-46a56a9727aa-00-od9aao8tsaq1.janeway.replit.dev/"),v.on("playerRole",k=>{N(a,k),N(o,!0),N(n,`VocÃª Ã© as ${k==="w"?"Brancas":"Pretas"}. Aguardando oponente.`)}),v.on("gameStart",k=>{console.log("Jogo iniciado!",k),N(t,T(k.fen)),N(d,k.timers.w),N(_,k.timers.b),N(n,"Jogo comeÃ§ou! Brancas jogam."),N(o,!1)}),v.on("gameState",k=>{N(t,T(k.fen)),N(d,k.timers.w),N(_,k.timers.b),L(k),p&&(p.currentTime=0,p.play().catch(()=>{}))}),v.on("timeUpdate",k=>{N(d,k.w),N(_,k.b)}),v.on("gameOver",k=>{N(o,!0);const I=k.winner?k.winner==="w"?"Brancas":"Pretas":null;switch(k.reason){case"disconnect":N(n,`Oponente desconectou. ${I} venceram!`);break;case"timeout":N(n,`Tempo esgotado! ${I} venceram.`);break;case"checkmate_or_draw":N(n,I?`Xeque-mate! ${I} venceram.`:"Empate!");break;default:N(n,"O jogo acabou.")}}),v.on("error",k=>{N(n,`Erro: ${k}`)}),()=>{v&&v.disconnect()})),Li();var S=Qn(),R=ae(S),pe=ae(R);br(pe);var fe=Ae(pe,2);ie(R);var Y=Ae(R,2);{var ye=k=>{var I=Un(),$=Ae(ae(I)),F=ae($,!0);ie($),ie(I),Xe(()=>ze(F,P(a)==="w"?"Brancas":"Pretas")),De(k,I)};fs(Y,k=>{P(a)&&k(ye)})}var ee=Ae(Y,2),z=ae(ee),ne=ae(z),xe=ae(ne);ie(ne);var Pe=Ae(ne,2),Qe=ae(Pe);ie(Pe),ie(z);var Te=Ae(z,2),We=ae(Te,!0);ie(Te);var $e=Ae(Te,2);let Ye;ps($e,5,()=>P(t),us,(k,I,$)=>{var F=ur(),te=pr(F);ps(te,1,()=>P(I),us,(be,Le,ue)=>{var Ee=Hn();let Ie;var pt=ae(Ee);{var dt=we=>{var Be=Vn();Xe(()=>{ct(Be,"src",`/pieces/${y[P(Le)]}`),ct(Be,"alt",P(Le))}),De(we,Be)};fs(pt,we=>{P(Le)&&we(dt)})}ie(Ee),Xe(we=>Ie=gs(Ee,1,`square ${($+ue)%2===0?"light":"dark"}`,"svelte-12gnbi7",Ie,we),[()=>({highlight:P(r).includes(String.fromCharCode(97+ue)+(8-$)),selected:P(s)===String.fromCharCode(97+ue)+(8-$)})],xt),os("click",Ee,()=>V($,ue)),De(be,Ee)}),De(k,F)}),ie($e),ie(ee),ie(S),Xe((k,I,$)=>{fe.disabled=!P(o),ze(xe,`Brancas: ${k??""}`),ze(Qe,`Pretas: ${I??""}`),ze(We,P(n)),Ye=gs($e,1,"board svelte-12gnbi7",null,Ye,$)},[()=>D(P(d)),()=>D(P(_)),()=>({flipped:P(a)==="b"})],xt),kr(pe,()=>P(u),k=>N(u,k)),os("click",fe,Q),De(i,S),fr()}export{Jn as component};
